<script>
  function resetProfileFields() {  

     document.getElementById("cv").value = "";
     google.script.run.withSuccessHandler(onSuccess).getProfileInformation();
  }
  
  function discardClicked(){
    window.location.reload(false);
    return true;
  }
  
  function strToISODateStr(strDate) {
    var parts = strDate.split('/');
    var date = new Date(parts[2], parts[0]-1, parts[1]);
    console.log(date);
    return date.toISOString().slice(0,10);
  }
  
  function updateClicked(){     
    var userInfo = {};
    userInfo.firstname = document.getElementById("fn").value;
    userInfo.lastname = document.getElementById("ln").value;
    userInfo.UIN = document.getElementById("uin_").value;
    userInfo.email = document.getElementById("email").value;
    userInfo.startsem = document.getElementById("start-semester").value;
    userInfo.qualstatus = document.getElementById("qual").value;
    userInfo.numattempts = document.getElementById("attempts").value;
    userInfo.advisor = document.getElementById("advisor").value;
    userInfo.coadvisor = document.getElementById("co-advisor").value;
    userInfo.degreeplanstatus = document.getElementById("degree-plan").value;
    userInfo.prelime_date  =  strToISODateStr(document.getElementById("prelim-date").value);
    userInfo.proposal_date  =  strToISODateStr(document.getElementById("proposal-date").value);
    userInfo.defense_date = strToISODateStr(document.getElementById("defense-date").value);
  
    google.script.run.submitProfile(userInfo);
  
    var cv = document.getElementById("cv").files[0];
    console.log(cv);
    if (cv){
      uploadFile(userInfo,cv,"cv");
    }
//    setTimeout(resetProfileFields, 2000);
//    resetProfileFields();
    alert("Data Updated");
  }
  
  function uploadFile(userInfo,f,file_type) {
    var file, reader = new FileReader();
    reader.onloadend = function(e) {
      google.script.run.withSuccessHandler(resetProfileFields)
      .uploadFileToDrive(
        e.target.result, file.name,
        userInfo.email,file_type
      );
    };
    
    file = f;
    if(file){  
      reader.readAsDataURL(file);
    } 
  }
  
  function onSuccess(userInfo) {
    
    console.log(userInfo);
    
    document.getElementById("fn").value = userInfo.firstname;
    document.getElementById("ln").value = userInfo.lastname;
    document.getElementById("uin_").value = userInfo.UIN;
    document.getElementById("email").value = userInfo.email;

        /////// For Drop Down//////////
        
    var a  = document.getElementById("start-semester");
    a.value = userInfo.startsem;
    M.FormSelect.init(a);
    
    var a  = document.getElementById("qual");
    a.value = userInfo.qualstatus;
    M.FormSelect.init(a);
    
    var a  = document.getElementById("attempts");
    a.value = userInfo.numattempts;
    M.FormSelect.init(a);
    
    var a  = document.getElementById("advisor");
    a.value = userInfo.advisor;
    M.FormSelect.init(a);
    
    var a  = document.getElementById("co-advisor");
    a.value = userInfo.coadvisor;
    M.FormSelect.init(a);
    
    var a  = document.getElementById("degree-plan");
    a.value = userInfo.degreeplanstatus;
    M.FormSelect.init(a);
    
    
    //////////////////////////////////////
    
    document.getElementById("prelim-date").value = userInfo.prelime_date;
    document.getElementById("proposal-date").value = userInfo.proposal_date;
    document.getElementById("defense-date").value = userInfo.defense_date;
    
    var a = document.getElementById('cv_url');
    if (userInfo.cv_url!=""){
      a.href = userInfo.cv_url;
    }
    
    M.updateTextFields()

  }

function check_cv(){
  var b = document.getElementById('cv_url');
  if(b.href==""){
    alert("CV not Uploaded");
  }
}



  // below from views/js/app.js
  
  
  function load_monitor(){
  
  M.textareaAutoResize($('#textarea1'));
  
  }
  
  function EditReview(){
  console.log("here");
  }
  
  document.addEventListener('DOMContentLoaded', function() {
  var elems = document.querySelectorAll('select');
  var instances = M.FormSelect.init(elems, {});
  });
  
  document.addEventListener('DOMContentLoaded', function() {
  var elems = document.querySelectorAll('.modal');
  var instances = M.Modal.init(elems, {dismissible: false, startingTop:'1%', endingTop:'0%'});
  });
  
//  document.addEventListener('DOMContentLoaded', function() {
//  var elems = document.querySelectorAll('.datepicker');
//  var instances = M.Datepicker.init(elems, options);
//  });

  $(document).ready(function(){
    $('.datepicker').datepicker({
      format: 'mm/dd/yyyy'
    });
  });
  
  document.addEventListener('DOMContentLoaded', function() {
  var elems = document.querySelectorAll('select');
  var instances = M.FormSelect.init(elems);
  });
  // Or with jQuery
  
  $(document).ready(function(){
  $('.modal').modal();
  });
  
  
  // Or with jQuery
  
  $(document).ready(function(){
  $('select').formSelect();
  });
  
  document.addEventListener('DOMContentLoaded', function() {
  var elems = document.querySelectorAll('.fixed-action-btn');
  var instances = M.FloatingActionButton.init(elems, {
  direction: 'left',
  hoverEnabled: false
  });
  });
  
  

</script>
