<script>
  function resetProfileFields() {  
////     var current_date = new Date();
////     var current_year = current_date.getFullYear();
////     
////     var year = 2000;
////     var till = current_year;
////     var options = "";
////     for(var y=year; y<=till; y++){
////     options += "<option>"+ y +"</option>";
////     }
////     document.getElementById("year").innerHTML = options;
     
     google.script.run.withSuccessHandler(onSuccess).getProfileInformation();
  }
  
  
  function updateClicked(){     
    var userInfo = {};
    userInfo.firstname = document.getElementById("fn").value;
    userInfo.lastname = document.getElementById("ln").value;
    userInfo.email = document.getElementById("email").value;
//    userInfo.reviewyear = document.getElementById("year").value;
    userInfo.advisor = document.getElementById("advisor").value;
    userInfo.coadvisor = document.getElementById("co-advisor").value;
    userInfo.first_sem_date  =  document.getElementById("start-semester").value;
    userInfo.dplan_filed_date  =  document.getElementById("degree-plan").value;
    userInfo.qual_passed = document.getElementById("qual").value;
    userInfo.qual_attempts = document.getElementById("attempts").value;
    userInfo.prelime_approved_date  =  document.getElementById("prelim-date").value;
    userInfo.proposal_approved_date  =  document.getElementById("proposal-date").value;
    userInfo.defense_date = document.getElementById("defense-date").value;
//    userInfo.final_exam_approved_date  =  document.getElementById("final_exam_approved").value;
//    userInfo.dissertation_approved_date  =  document.getElementById("dissertation_approved").value;
  
    google.script.run.submitProfile(userInfo);
  
    var cv = document.getElementById("cv").files[0];
    console.log(cv);
    if (cv){
      uploadFile(userInfo,cv,"cv");
    }
//    setTimeout(resetProfileFields, 1000);
//    resetProfileFields();
    alert("Data Updated");
  }
  
  function uploadFile(userInfo,f,file_type) {
    var file, reader = new FileReader();
    reader.onloadend = function(e) {
      google.script.run
      .uploadFileToDrive(
        e.target.result, file.name,
        userInfo.email,file_type
      );
    };
    
    file = f;
    if(file){  
      reader.readAsDataURL(file);
    } 
  }
  
  function onSuccess(userInfo) {
    document.getElementById("email").value = userInfo.email;
    document.getElementById("fn").value = userInfo.firstname;
    document.getElementById("ln").value = userInfo.lastname;
//    document.getElementById("year").value = userInfo.reviewyear;
    document.getElementById("advisor").value = userInfo.advisor; 
    document.getElementById("start-semester").value = userInfo.first_sem_date;
    document.getElementById("degree-plan").value=userInfo.dplan_filed_date;
    document.getElementById("qual").value = userInfo.qual_passed;
    document.getElementById("prelim_approved").value = userInfo.prelime_approved_date;
    document.getElementById("proposal_approved").value = userInfo.proposal_approved_date;
//    document.getElementById("final_exam_approved").value = userInfo.final_exam_approved_date;
//    document.getElementById("dissertation_approved").value = userInfo.dissertation_approved_date;

  }
  
  // below from views/js/app.js
  
  
  function load_monitor(){
  
  M.textareaAutoResize($('#textarea1'));
  
  }
  
  function EditReview(){
  console.log("here");
  }
  
  document.addEventListener('DOMContentLoaded', function() {
  var elems = document.querySelectorAll('select');
  var instances = M.FormSelect.init(elems, {});
  });
  
  document.addEventListener('DOMContentLoaded', function() {
  var elems = document.querySelectorAll('.modal');
  var instances = M.Modal.init(elems, {dismissible: false, startingTop:'1%', endingTop:'0%'});
  });
  
  document.addEventListener('DOMContentLoaded', function() {
  var elems = document.querySelectorAll('.datepicker');
  var instances = M.Datepicker.init(elems);
  });
  
  document.addEventListener('DOMContentLoaded', function() {
  var elems = document.querySelectorAll('select');
  var instances = M.FormSelect.init(elems);
  });
  // Or with jQuery
  
  $(document).ready(function(){
  $('.modal').modal();
  });
  
  
  // Or with jQuery
  
  $(document).ready(function(){
  $('select').formSelect();
  });
  
  document.addEventListener('DOMContentLoaded', function() {
  var elems = document.querySelectorAll('.fixed-action-btn');
  var instances = M.FloatingActionButton.init(elems, {
  direction: 'left',
  hoverEnabled: false
  });
  });

</script>
